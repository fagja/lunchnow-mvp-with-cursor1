# projectbrief.md

本ドキュメントは「LunchNow」アプリの**全体要件定義書**です。

**本ドキュメントの主な内容**:
- アプリの目的・コンセプト
- MVP方針と優先順位
- 全体アーキテクチャと技術選定
- ロードマップと開発フェーズ

**関連ドキュメント**:
- [データ要件定義書](./data_requirement.md): データモデル、テーブル構造、運用ルール
- [UI要件定義書](./ui_requirement.md): 画面構成、UI要素、ユーザーフロー

## 1. アプリ概要

- **アプリ名**: LunchNow
- **目的**: 慶應大学日吉キャンパス内で「今すぐランチ」をする相手を即座に見つけ、最小限の設定でシームレスにマッチングできるようにする。
- **対象ユーザー**: 慶應大学日吉キャンパスで、空きコマや昼休みの時間に即座にランチ仲間を探したい学生。
- **プラットフォーム**: Webアプリ（レスポンシブ）
- **言語**: 日本語のみ

### 主な目的

- 慶應日吉キャンパスの学生間での**即座の**ランチ交流を促進する。
- 最小限の設定で利用できる、**軽量でシームレス**なユーザー体験を提供する。
- 学生同士を**効率的に**見つけ、マッチングする。

---

## 2. アプリの特徴・運用方針

- **今すぐランチ**に特化した設計：その日の空き時間内でマッチングを完結させる
- 翌日には「Like」「マッチ」「ステータス」の状態をリセット
  - DBには履歴として残すが、ユーザーからは見えない
- 一般的なマッチングアプリと異なり、長期的なやり取りではなく、当日内に完結する

---

## 3. MVP設計方針

### MVPの定義と基本方針

**MVP（Minimum Viable Product：実用最小限の製品）** とは、「ユーザーに最低限の価値を提供できる製品」を指します。本プロジェクトでは以下の方針でMVP開発を進めます：

1. **機能の最小化**:
   - ユーザーの核心的なニーズ（「今すぐランチ相手を見つけたい」）を満たす最小限の機能セットのみに絞る
   - 「あったら良い」機能は全て後回し
   - UI/UXも最小限の機能性を重視し、装飾は二の次

2. **迅速な価値提供**:
   - 開発期間を1-2週間に限定
   - 「完璧」を目指さず、「使える」状態を優先
   - 早期にユーザーテストを行い、フィードバックを収集

3. **後続開発のための基盤構築**:
   - コードの品質と拡張性は確保
   - 将来的な機能追加を考慮したデータモデル設計
   - テクニカルデットを最小限に

> **注意**: このMVP方針はプロジェクト全体に適用され、他のドキュメントでも参照されます。UI要件定義書やデータ要件定義書においても同じMVP方針に基づいた判断を行っています。

### MVPフォーカス領域

MVPでは以下の領域に **絶対にフォーカス** します：

- **コア機能のみの実装**: プロフィール設定、ステータス設定、ユーザー一覧表示、マッチング、チャット
- **基本的なエラーハンドリング**: 主要操作におけるエラー表示と回復手段
- **最低限のセキュリティ**: 基本的なバリデーションと権限管理

### MVP対象外の明確化

以下の要素は **MVPには含めない** ことを明確にします：

- **高度な機能**: プッシュ通知、画像アップロード、自動更新機能、絞り込み検索など
- **複雑なUIアニメーション**: 基本的な動きと状態変化のみを実装
- **管理者機能**: 運用管理はSupabaseの標準機能を活用
- **大規模なパフォーマンス最適化**: 基本的なレスポンス要件を満たす程度
- **厳格なセキュリティ対策**: 重要な個人情報を扱わないため、基本的なHTTPS通信以外の高度なセキュリティ対策は後回し

### MVPからの段階的成長

MVPリリース後は以下のアプローチで段階的に成長させます：

1. **ユーザーフィードバックの収集と分析**
2. **優先度の高い機能から順次追加** (ロードマップセクション参照)
3. **継続的な改善サイクルの確立** (リリース→フィードバック→改善)

この方針により、最小限のリソースで最大の価値提供を実現し、ユーザーにとって真に必要な機能を見極めた上での開発を進めていきます。

---

## 4. 機能一覧（MVPスコープ）

### MVP実装機能

1. **プロフィール作成・編集**
   - ニックネーム
   - 学年
   - 学部

2. **ステータス設定・編集**
   - 空き時間・場所指定

3. **オンラインユーザー一覧表示**（カード表示・手動リロード）
   - **表示条件**:
     - 自分以外
     - 当日分のみ
     - 未マッチ
     - 募集開始から20分以内

4. **マッチング機能**
   - 相互「とりまランチ？」(Like)によるマッチ成立
   - 1ユーザーは同時に1マッチのみ
   - マッチ成立時のポップアップ

5. **チャット機能**
   - マッチした相手との1対1メッセージ
   - 3秒間隔のポーリングによるメッセージ取得（画面遷移時やバックグラウンド時は自動停止）
   - マッチキャンセル機能

### MVP除外機能

- 正式なユーザー認証（慶應メール認証）
- プロフィール画像アップロード
- リアルタイム自動更新機能（注：**チャット画面のみ3秒間隔のポーリングを例外的に実装**、ユーザー一覧は手動更新のみ）
- 絞り込み検索・フィルター機能
- 相手からの「Like」通知・確認
- 多言語・他キャンパス対応
- 管理者画面（Supabase標準画面で代替）

---

## 5. 技術スタック

### 5.1 フロントエンド

- **フレームワーク**: Next.js 14以降（App Router）
  - 理由: サーバーコンポーネントとクライアントコンポーネントの分離により開発効率向上

- **言語**: TypeScript
  - 理由: 型安全性による開発効率向上とエラー防止。MVPでも価値あり

- **UIライブラリ**: React 18以降
  - 理由: Next.jsの基盤として必須

- **スタイリング**: Tailwind CSS
  - 理由: ユーティリティクラスによる高速な開発が可能。MVPの迅速な開発に適合

#### UIコンポーネント
- **コンポーネントライブラリ**: shadcn/ui（厳選したコンポーネントのみ）
  - 必要なコンポーネントのみをコピーして使用（バンドルサイズ最適化）
  - 具体的には: Button、Card、TextField、Dropdown/Select、Modal、Toast程度に限定

- **アイコン**: Heroicons（必要最小限のみ）
  - 基本的なアイコンのみ使用し、複雑なカスタマイズは避ける

- **フォーム管理**: HTML標準機能
  - HTML標準の`required`属性と`maxlength`属性のみを使用
  - 追加ライブラリ不要でブラウザ標準バリデーションに依存

#### 状態管理
- **サーバー状態**: SWR
  - キャッシュとリフェッチ機能はMVPでも必須。シンプルなSWRで十分

- **クライアント状態**: React Context + useState
  - 複雑なステート管理ライブラリは不要。ネイティブAPIで十分対応可能

### 5.2 バックエンド

- **BaaS**: Supabase
  - **データベース**: PostgreSQL
  - **認証**: LocalStorageによる数値ID管理（シンプル化）
  - **API**: Supabase JavaScript Client（RESTful API利用）
    - カスタムAPIエンドポイントの作成は最小限に抑え、既存のSupabase機能を最大活用

### 5.3 開発・デプロイ環境

- **コード品質**:
  - **ESLint**: 基本設定のみ（カスタムルール最小限）
  - **Prettier**: 一貫したコードフォーマット

- **ホスティング**:
  - **フロントエンド**: Vercel
  - **バックエンド**: Supabase Cloud

- **CI/CD**:
  - Vercel GitHubインテグレーション（自動デプロイ）
  - 環境変数: .env.local（開発環境）

- **環境分離**:
  - MVPフェーズでは開発環境のみで開発を進め、ユーザーテスト直前に本番環境を準備

### 5.4 テスト戦略

- MVPでは開発者による手動テストに集中
  - クリティカルパス（ユーザー登録→ランチ設定→マッチング→チャット）のテストを優先
  - 自動テストはMVP後に導入予定

### 5.5 実装方針

- MVPでは迅速な開発を最優先し、実装をシンプルに保つ
- 将来的な拡張性確保のためTypeScriptを活用
- 標準的なパターンを採用し、独自実装は最小限に
- 必要最小限のデータ取得とキャッシュ利用でパフォーマンスを確保
- シンプルなデータモデルを採用し、開発効率を優先

### 5.6 将来的な拡張オプション

- **React Native**によるモバイルアプリ化を想定し、データ設計は柔軟性を持たせる
- 正式な認証システム（慶應メール認証）への移行を考慮したデータモデル設計
- 画像アップロード、プッシュ通知などの機能はMVP後に実装予定

---

## 6. 非機能要件

### パフォーマンス
- **最大同時接続数**: 初期段階で100ユーザー程度を想定
- **ページ読み込み時間**: 3秒以内を目標

### セキュリティ
- **HTTPS通信必須**
- **匿名性**: ニックネームのみでの利用を可能に
- **MVPでのセキュリティ方針**:
  - MVP段階では個人情報をほとんど扱わないため、高度なセキュリティ対策は優先度を下げる
  - ユーザー識別にはLocalStorage + 数値IDの組み合わせを使用
  - メールアドレスや本名など個人を特定できる情報は収集しない
  - 将来的な拡張フェーズで、必要に応じてセキュリティ強化を実施

### 拡張性
- 将来的な機能追加を考慮したデータモデル設計

---

## 7. 想定ユースケース

本アプリは「今すぐランチ相手を探したい」という**超短時間の利用シナリオ**を想定
具体的には、ユーザーが1日に本アプリを開くのは、主に昼休みや空きコマ前後のタイミングで基本**1回のみ**であり、その際のアプリ利用時間は**最大でも15分程度**

1. **アプリを開いてからマッチが成立するまで**
   - 最長でも10分程度で、条件の合うユーザーを一覧から見つけ、相互Likeによるマッチングが行われる。
2. **チャットでランチ場所や集合時間を数分確認**
   - 最低限のチャットで、実際のランチへ移行する想定。
3. **ランチ相手が見つかったら**
   - アプリを閉じ、オフラインでランチ。アプリの再利用は1日1回程度に限られる。

このように、「今すぐ誰かとランチしたい」という一時的・突発的なニーズに対応するため、**長時間のアプリ使用や何度もログインするケースはあまり想定していません**。ランチ相手を見つけた時点でアプリの役割が完了する設計となっています。

---

## 8. 画面一覧と画面遷移

### 8.1 画面一覧

 | 画面名                | 内容                                                 |
 |-----------------------|------------------------------------------------------|
 | **ランチ設定画面**(`/setup`) | プロフィール (必須: ニックネーム,学年,学部) とステータス (任意:空き時間,場所) を一括入力 |
 | **ユーザー一覧画面** (`/users`)  | 募集中ユーザー(自分除く)をカード表示し、相互Likeでマッチ成立          |
 | **チャット画面** (`/chat`)       | マッチ成立したユーザーとの1対1チャット。マッチキャンセル可                   |

### 8.2 画面遷移

ランチ設定画面 (/setup)
↓ (保存成功)
ユーザー一覧画面 (/users)
↓ (マッチ成立時)
チャット画面 (/chat)
↓ (キャンセル時)
ユーザー一覧画面 (/users)

- **マッチ成立**: 相互Like完了 → ポップアップ表示 → チャット画面へ
- **キャンセル時**: チャット画面からユーザー一覧画面へ戻る

---

## 9. ロードマップ

### 9.1 MVPで実装する機能（優先順位順）

1. **ステータス設定・編集**（実装の複雑さ: 低）
   - 空き時間・場所指定
   - 「募集中」状態のオン/オフ

2. **オンラインユーザー一覧表示**（実装の複雑さ: 中）
   - 手動リロードによる「募集中」ユーザーの表示

3. **プロフィール作成・編集**（実装の複雑さ: 低）
   - ニックネーム、学年、学部の入力・保存
   - LocalStorageによる数値ID管理

4. **マッチング機能**（実装の複雑さ: 中）
   - 相互「とりまランチ？」(Like)機能
   - マッチ成立時のポップアップ

5. **チャット機能**（実装の複雑さ: 中）
   - マッチした相手との1対1メッセージ
   - 3秒間隔のポーリングによるメッセージ取得（画面遷移時やバックグラウンド時は自動停止）
   - マッチキャンセル機能

### 9.2 MVP後の拡張機能（優先順位順）

1. **プロフィール画像の追加**（実装の複雑さ: 中）
   - Supabase Storageを活用した画像アップロード
   - 画像の圧縮・最適化

2. **簡易ログ・アナリティクス機能**（実装の複雑さ: 中）
   - 基本的な利用統計の収集
   - ダッシュボード表示

3. **あなたにいいねしたユーザー一覧**（実装の複雑さ: 中）
   - 通知システムの実装
   - いいね履歴の表示

4. **日次リセットの自動化**（実装の複雑さ: 中）
   - バッチ処理によるデータリセット
   - 古いデータのアーカイブ

5. **フィードバック収集**（実装の複雑さ: 低）
   - 簡易フォームの実装
   - フィードバック管理システム

6. **プライバシーポリシー／利用規約**（実装の複雑さ: 低）
   - 法的文書の整備
   - 同意フローの実装

7. **PWA化**（実装の複雑さ: 中）
   - ホーム画面へのインストール機能
   - オフラインサポート
   - キャッシュ戦略の最適化

8. **プッシュ通知**（実装の複雑さ: 高）
   - いいね受信時の通知
   - マッチ成立時の通知
   - 新着メッセージの通知

9. **リアルタイム更新機能**（実装の複雑さ: 高）
   - WebSocketを利用したリアルタイム更新
   - 自動更新ユーザーリスト
   - チャットのリアルタイム更新

10. **絞り込み検索・フィルター機能**（実装の複雑さ: 中）
    - 検索条件の拡張
    - UI/UXの改善

### 9.3 開発フェーズ

**フェーズ1（MVP）**: 1週間 - 2週間
- 基本機能の実装（上記9.1のすべての機能）
- 簡易テスト環境の構築
- ユーザーテストの実施

**フェーズ2（MVP+）**: 2週間 - 3週間
- 9.2の項目1-3の実装（プロフィール画像、簡易ログ・アナリティクス、いいね一覧）
- フィードバックに基づくMVP機能の改善
- パフォーマンス最適化

**フェーズ3（拡張）**: 3週間 - 4週間
- 9.2の項目4-6の実装（日次リセット、フィードバック収集、プライバシーポリシー）
- セキュリティ強化
- ユーザビリティ改善

**フェーズ4（完成）**: 4週間以降
- 9.2の残りの項目の実装（PWA化、プッシュ通知など）
- 本格的な運用体制の構築
- スケーリング対応

---

## 10. 技術的考慮点

### MVPでの対応方針
- **エラー処理**: 基本的なネットワークエラーと入力エラーの表示
- **オフライン対応**: MVPでは最小限の対応（エラーメッセージ表示のみ）
- **パフォーマンス**: 必要最小限のデータ取得とキャッシュ利用
- **フロントエンド実装の簡素化**:
  - **バリデーション**: クライアント側バリデーションのみに集中し、サーバー側は将来的に追加
  - **エラー表示**: 共通エラーコンポーネントによる統一的な表示
  - **UIコンポーネント**: 再利用可能なコンポーネントを使用し、コードの重複を削減
  - **複雑な機能の最小化**: リアルタイム通信は後回し
- **パフォーマンス改善**:
  - **シンプルなキャッシュ戦略**:
    - **募集中ユーザー一覧**: SWRによる短期間（30秒）のキャッシュで再取得頻度を削減
    - **ユーザー情報**: 変更頻度の低いデータの長期キャッシュ
    - クライアント側キャッシュを活用し、サーバー負荷を軽減
  - **最小限のインデックス最適化**:
    - **頻出クエリのみ**: ユーザー検索用の(is_matched, recruiting_since)など
    - 更新頻度とのバランスを考慮した厳選されたインデックス設計
    - フルテキスト検索や複雑な条件検索はMVP後に実装

---

## 11. セキュリティ対策

### MVPでの対応方針
- Next.jsの標準セキュリティ機能の活用
- パラメータ化クエリによるSQLインジェクション対策
- 基本的なレート制限の実装
- データベースの基本的な制約（NOT NULL、文字数制限）のみに依存

---

## 12. テスト戦略

### 12.1 MVPフェーズのテスト方針

**MVPでは開発速度と機能実装を最優先**するため、以下のテスト方針を採用します：

- **自動テスト機能の実装は行わない**: MVP完成後のフェーズで導入を検討
- **開発者による手動テスト**を中心に品質を確保
- **以下のクリティカルパス（主要ユーザーフロー）のみを重点的にテスト**:
  1. ユーザー登録
  2. ランチ設定
  3. マッチング
  4. チャット
- **エッジケースや例外的なケースのテストは優先度を下げ**、開発リソースをコア機能実装に集中
- **テスト用のデータや機能**は本番環境と明確に分離

この方針により、開発リソースをMVPのコア機能実装に集中させ、プロダクトとテストコードの混在による混乱や開発の複雑化を避けます。

### 12.2 MVP完成後のテスト戦略

MVPの完成後、以下の順序でテスト機能を段階的に導入していきます：

1. **重要なロジックのユニットテスト**
   - マッチング処理
   - 「当日」判定ロジック
   - データ整合性確保の処理

2. **主要画面のインテグレーションテスト**
   - ユーザー一覧表示
   - マッチング処理
   - チャット機能

3. **E2Eテスト**
   - コアユーザーフローの自動テスト
   - 異常系シナリオの検証

このアプローチにより、MVPの迅速な実装と、その後の堅牢な品質確保の両立を図ります。
