# LunchNow MVPロードマップ

## ドキュメント概要
- **目的**: MVP完成までのタスク管理と進捗の可視化
- **対象**: プロジェクトオーナーおよびAIコーディングエージェント
- **更新方法**: タスク完了時にチェックマーク（x）を付ける

## 階層構造の説明
このロードマップでは、以下の4階層でタスクを管理します：

1. **フェーズ (Phase) - P**: 最も大きな開発段階の区分
   - 例: P1 = 環境構築・設計、P2 = データ層実装
   - プロジェクトの主要な開発段階を表します

2. **エピック (Epic) - E**: フェーズ内の機能グループや関連作業
   - 例: P1-E2 = 依存関係のセットアップ
   - 関連する作業や機能のまとまりを表します

3. **ストーリー (Story) - S**: 具体的な機能実装単位
   - 例: P1-E2-S1 = Tailwind CSS導入
   - 一連の関連タスクをまとめた、独立して価値を持つ単位です

4. **タスク (Task) - T**: 個別の実装作業（チェックボックス単位）
   - 例: P1-E2-S1-T1 = パッケージインストール
   - 最小の作業単位で、完了するとチェックマークを付けます

各タスクはタスク番号（例: T1.2.3.4）で参照できます。これは「フェーズ1のエピック2のストーリー3のタスク4」を意味します。

## タスクロードマップ

### フェーズ1: 環境構築・設計
#### エピック1.1: プロジェクト初期化
##### ストーリー1.1.1: Next.js 15プロジェクト作成
- [x] **タスク1.1.1.1**: create-next-appの実行
- [x] **タスク1.1.1.2**: App Routerの有効化
- [x] **タスク1.1.1.3**: 初期ファイル整理

##### ストーリー1.1.2: Git環境のセットアップ
- [x] **タスク1.1.2.1**: Gitリポジトリの初期化
- [x] **タスク1.1.2.2**: .gitignoreファイルの作成
- [x] **タスク1.1.2.3**: 初期コミットの実行
- [x] **タスク1.1.2.4**: mainとdevelopブランチの作成

##### ストーリー1.1.3: TypeScript、ESLint、Prettierの設定
- [x] **タスク1.1.3.1**: tsconfig.jsonの最適化
- [x] **タスク1.1.3.2**: ESLint設定ファイル作成
- [x] **タスク1.1.3.3**: Prettier設定ファイル作成

##### ストーリー1.1.4: ディレクトリ構造の整備
- [x] **タスク1.1.4.1**: src/ディレクトリ作成
- [x] **タスク1.1.4.2**: app/ディレクトリ構成設計
- [x] **タスク1.1.4.3**: components/ディレクトリ構成設計
- [x] **タスク1.1.4.4**: hooks/（カスタムフック）ディレクトリ作成
- [x] **タスク1.1.4.5**: lib/（ユーティリティ関数）ディレクトリ作成
- [x] **タスク1.1.4.6**: types/（共通型定義）ディレクトリ作成
- [x] **タスク1.1.4.7**: api/（APIクライアント関数）ディレクトリ作成

- [x] **エピック1.1レビュー、リファクタリング**

#### エピック1.2: 依存関係のセットアップ
##### ストーリー1.2.1: Tailwind CSS導入
- [x] **タスク1.2.1.1**: パッケージインストール
- [x] **タスク1.2.1.2**: 設定ファイル作成
- [x] **タスク1.2.1.3**: カラーテーマ設定
- [x] **タスク1.2.1.4**: カスタムユーティリティ定義

##### ストーリー1.2.2: shadcn/ui基本コンポーネント設定
- [x] **タスク1.2.2.1**: CLIセットアップ
- [x] **タスク1.2.2.2**: 必要コンポーネント選定
- [x] **タスク1.2.2.3**: コンポーネントインストール
- [x] **タスク1.2.2.4**: テーマカスタマイズ

##### ストーリー1.2.3: SWRセットアップ
- [x] **タスク1.2.3.1**: パッケージインストール
- [x] **タスク1.2.3.2**: グローバル設定（キャッシュ設定など）
- [x] **タスク1.2.3.3**: カスタムフェッチャー作成
- [x] **タスク1.2.3.4**: エラーハンドリング設定

- [x] **エピック1.2レビュー、リファクタリング**

#### エピック1.3: Supabase連携準備
##### ストーリー1.3.1: Supabase CLIのインストールと設定
- [x] **タスク1.3.1.1**: Docker環境の確認
- [x] **タスク1.3.1.2**: `npx supabase init`コマンドによるCLIのダウンロード、プロジェクト初期化
- [x] **タスク1.3.1.3**: スキーマファイル作成ディレクトリ構造整備

##### ストーリー1.3.2: ローカル開発環境でのSupabase起動
- [x] **タスク1.3.2.1**: `npx supabase start`コマンドによるローカルサーバー起動
- [x] **タスク1.3.2.2**: ローカルダッシュボードへのアクセス確認

##### ストーリー1.3.3: 環境変数設定
- [x] **タスク1.3.3.1**: `.env.local`ファイルへの環境変数追加

##### ストーリー1.3.4: Supabaseクライアント設定
- [x] **タスク1.3.4.1**: クライアントライブラリのインストール
- [x] **タスク1.3.4.2**: 初期化コード作成
- [x] **タスク1.3.4.3**: 型定義の準備

##### ストーリー1.3.5: セキュリティ設定
- [x] **タスク1.3.5.1**: RLS（Row Level Security）ポリシー設計
- [x] **タスク1.3.5.2**: 匿名ユーザーアクセスルール設定

- [x] **エピック1.3レビュー、リファクタリング**

#### エピック1.4: ベース設計実装
##### ストーリー1.4.1: ルーティング設定（App Router）
- [x] **タスク1.4.1.1**: 基本ページ構造の定義
- [x] **タスク1.4.1.2**: ルートレイアウト作成
- [x] **タスク1.4.1.3**: エラーページ設定

##### ストーリー1.4.2: レイアウトコンポーネント作成
- [x] **タスク1.4.2.1**: 共通ヘッダー設計
- [x] **タスク1.4.2.2**: フッター設計
- [x] **タスク1.4.2.3**: ページコンテナ作成

##### ストーリー1.4.3: 共通ユーティリティ関数定義
- [x] **タスク1.4.3.1**: 日付・時間操作関数
- [x] **タスク1.4.3.2**: フォーマット関数
- [x] **タスク1.4.3.3**: バリデーション関数

##### ストーリー1.4.4: 型定義ファイル作成
- [x] **タスク1.4.4.1**: データモデル型定義
- [x] **タスク1.4.4.2**: API型定義
- [x] **タスク1.4.4.3**: コンポーネント型定義

- [x] **エピック1.4レビュー、リファクタリング**

- [x] **フェーズ1レビュー、リファクタリング**

### フェーズ2: データ層実装
#### エピック2.1: データベーススキーマ作成
##### ストーリー2.1.1: usersテーブル定義
- [x] **タスク2.1.1.1**: テーブル定義（カラム・型）
- [x] **タスク2.1.1.2**: インデックス設定
- [x] **タスク2.1.1.3**: RLSポリシー設定

##### ストーリー2.1.2: likesテーブル定義
- [x] **タスク2.1.2.1**: テーブル定義（カラム・型）
- [x] **タスク2.1.2.2**: インデックス設定
- [x] **タスク2.1.2.3**: RLSポリシー設定

##### ストーリー2.1.3: matchesテーブル定義
- [x] **タスク2.1.3.1**: テーブル定義（カラム・型）
- [x] **タスク2.1.3.2**: インデックス設定
- [x] **タスク2.1.3.3**: RLSポリシー設定

##### ストーリー2.1.4: messagesテーブル定義
- [x] **タスク2.1.4.1**: テーブル定義（カラム・型）
- [x] **タスク2.1.4.2**: インデックス設定
- [x] **タスク2.1.4.3**: RLSポリシー設定

##### ストーリー2.1.5: マイグレーションスクリプト作成
- [x] **タスク2.1.5.1**: 初期スキーマ作成SQL
- [x] **タスク2.1.5.2**: シードデータSQL

- [x] **エピック2.1レビュー、リファクタリング**

#### エピック2.2: API実装: ユーザー
##### ストーリー2.2.1: ユーザー作成・更新API
- [x] **タスク2.2.1.1**: ユーザー登録処理実装
- [x] **タスク2.2.1.2**: プロフィール更新処理実装
- [x] **タスク2.2.1.3**: クライアント側関数作成

##### ストーリー2.2.2: ユーザー取得API
- [x] **タスク2.2.2.1**: 単一ユーザー取得処理
- [x] **タスク2.2.2.2**: クライアント側関数作成

##### ストーリー2.2.3: 募集中ユーザー一覧取得API
- [x] **タスク2.2.3.1**: フィルター条件設計
- [x] **タスク2.2.3.2**: クエリ最適化
- [x] **タスク2.2.3.3**: クライアント側関数作成

- [x] **エピック2.2レビュー、リファクタリング**

#### エピック2.3: API実装: マッチング
##### ストーリー2.3.1: いいね登録・取得API
- [x] **タスク2.3.1.1**: いいね登録処理実装
- [x] **タスク2.3.1.2**: いいねリスト取得処理
- [x] **タスク2.3.1.3**: クライアント側関数作成

##### ストーリー2.3.2: マッチング判定・登録API
- [x] **タスク2.3.2.1**: 相互いいね判定ロジック
- [x] **タスク2.3.2.2**: マッチ登録処理
- [x] **タスク2.3.2.3**: クライアント側関数作成

##### ストーリー2.3.3: マッチキャンセルAPI
- [x] **タスク2.3.3.1**: キャンセル処理実装
- [x] **タスク2.3.3.2**: 相互Like削除処理
- [x] **タスク2.3.3.3**: クライアント側関数作成

- [x] **エピック2.3レビュー、リファクタリング**

#### エピック2.4: API実装: メッセージ
##### ストーリー2.4.1: メッセージ送信API
- [x] **タスク2.4.1.1**: メッセージ保存処理
- [x] **タスク2.4.1.2**: クライアント側関数作成

##### ストーリー2.4.2: メッセージ履歴取得API
- [x] **タスク2.4.2.1**: 履歴取得処理
- [x] **タスク2.4.2.2**: ページネーション対応
- [x] **タスク2.4.2.3**: クライアント側関数作成

- [x] **エピック2.4レビュー、リファクタリング**

- [x] **フェーズ2レビュー、リファクタリング**

### フェーズ3: UI基盤構築
#### エピック3.1: 共通UIコンポーネント作成
##### ストーリー3.1.1: 基本入力コンポーネント実装
- [x] **タスク3.1.1.1**: Buttonコンポーネント（バリエーション含む）
- [x] **タスク3.1.1.2**: TextFieldコンポーネント（バリデーション含む）
- [x] **タスク3.1.1.3**: SelectFieldコンポーネント

##### ストーリー3.1.2: コンテンツ表示コンポーネント実装
- [x] **タスク3.1.2.1**: Cardコンポーネント（ユーザーカード用）
- [x] **タスク3.1.2.2**: MessageBubbleコンポーネント（送信・受信別）

##### ストーリー3.1.3: 通知コンポーネント実装
- [x] **タスク3.1.3.1**: Modalコンポーネント
- [x] **タスク3.1.3.2**: Toastコンポーネント
- [x] **タスク3.1.3.3**: 表示・非表示制御関数

##### ストーリー3.1.4: 状態表示コンポーネント実装
- [x] **タスク3.1.4.1**: スピナーコンポーネント
- [x] **タスク3.1.4.2**: スケルトンローディングコンポーネント

- [x] **エピック3.1レビュー、リファクタリング**

#### エピック3.2: レイアウト実装
##### ストーリー3.2.1: 共通レイアウト
- [x] **タスク3.2.1.1**: PageContainerコンポーネント
- [x] **タスク3.2.1.2**: 共通パディング・マージン設定
- [x] **タスク3.2.1.3**: レスポンシブ対応

##### ストーリー3.2.2: レスポンシブデザイン
- [x] **タスク3.2.2.1**: ブレークポイント設定
- [x] **タスク3.2.2.2**: モバイルファースト対応
- [x] **タスク3.2.2.3**: 画面サイズ別レイアウト調整

- [x] **エピック3.2レビュー、リファクタリング**

#### エピック3.3: ユーティリティ作成
##### ストーリー3.3.1: 日時ユーティリティ
- [x] **タスク3.3.1.1**: 現在時刻からのend_time選択肢生成関数
- [x] **タスク3.3.1.2**: 日付フォーマット関数

##### ストーリー3.3.2: フォームユーティリティ
- [x] **タスク3.3.2.1**: 必須入力チェック
- [x] **タスク3.3.2.2**: 文字数チェック
- [x] **タスク3.3.2.3**: 特殊文字チェック

##### ストーリー3.3.3: ストレージユーティリティ
- [x] **タスク3.3.3.1**: ユーザーID保存・取得
- [x] **タスク3.3.3.2**: 設定保存・取得

##### ストーリー3.3.4: API連携ユーティリティ
- [x] **タスク3.3.4.1**: useSWRラッパー関数
- [x] **タスク3.3.4.2**: API呼び出し共通関数

##### ストーリー3.3.5: ポーリングユーティリティ
- [x] **タスク3.3.5.1**: 汎用ポーリングフックusePollingの実装

- [x] **エピック3.3レビュー、リファクタリング**

- [x] **フェーズ3レビュー、リファクタリング**

### フェーズ4: 画面実装
#### エピック4.1: ランチ設定画面（/setup）
##### ストーリー4.1.1: フォーム構造
- [x] **タスク4.1.1.1**: ニックネーム入力欄
- [x] **タスク4.1.1.2**: 学年選択欄
- [x] **タスク4.1.1.3**: 学部選択欄
- [x] **タスク4.1.1.4**: 空き時間選択機能
- [x] **タスク4.1.1.5**: 場所選択機能

##### ストーリー4.1.2: バリデーション
- [x] **タスク4.1.2.1**: フロントエンドバリデーション
- [x] **タスク4.1.2.2**: エラーメッセージ表示

##### ストーリー4.1.3: API連携
- [x] **タスク4.1.3.1**: 保存処理連携
- [x] **タスク4.1.3.2**: 初期値取得処理

##### ストーリー4.1.4: 画面テスト
- [x] **タスク4.1.4.1**: 基本機能の手動テスト（入力、保存、遷移）

- [x] **エピック4.1レビュー、リファクタリング**

#### エピック4.2: ユーザー一覧画面（/users）
##### ストーリー4.2.1: ユーザーリスト表示
- [ ] **タスク4.2.1.1**: ユーザーカードコンポーネント
- [ ] **タスク4.2.1.2**: 一覧レイアウト
- [ ] **タスク4.2.1.3**: 空状態表示

##### ストーリー4.2.2: 更新機能
- [ ] **タスク4.2.2.1**: リロードボタン
- [ ] **タスク4.2.2.2**: ローディング表示

##### ストーリー4.2.3: いいね機能
- [ ] **タスク4.2.3.1**: いいねボタン
- [ ] **タスク4.2.3.2**: いいね状態表示

##### ストーリー4.2.4: マッチング通知
- [ ] **タスク4.2.4.1**: マッチング通知UI実装
- [ ] **タスク4.2.4.2**: マッチング検出機能実装
- [ ] **タスク4.2.4.3**: マッチング後の状態遷移実装

- [ ] **エピック4.2レビュー、リファクタリング**

#### エピック4.3: チャット画面（/chat）
##### ストーリー4.3.1: チャットUI
- [ ] **タスク4.3.1.1**: メッセージリスト表示
- [ ] **タスク4.3.1.2**: 送信フォーム
- [ ] **タスク4.3.1.3**: スクロール制御

##### ストーリー4.3.2: メッセージング機能
- [ ] **タスク4.3.2.1**: メッセージ送信処理
- [ ] **タスク4.3.2.2**: 送信状態表示
- [ ] **タスク4.3.2.3**: エラーハンドリング

##### ストーリー4.3.3: リアルタイム機能
- [ ] **タスク4.3.3.1**: 共通ポーリングフックを活用したメッセージ取得
- [ ] **タスク4.3.3.2**: メッセージ送信とリアルタイム反映

##### ストーリー4.3.4: キャンセル機能
- [ ] **タスク4.3.4.1**: キャンセルボタン
- [ ] **タスク4.3.4.2**: 確認ダイアログ
- [ ] **タスク4.3.4.3**: キャンセル処理実行

- [ ] **エピック4.3レビュー、リファクタリング**

#### エピック4.4: 画面遷移とリダイレクト
##### ストーリー4.4.1: ルート制御
- [ ] **タスク4.4.1.1**: 初期アクセス判定
- [ ] **タスク4.4.1.2**: 適切なページへの遷移

##### ストーリー4.4.2: ユーザー状態制御
- [ ] **タスク4.4.2.1**: 未認証時のリダイレクト
- [ ] **タスク4.4.2.2**: 認証済み時の制御

##### ストーリー4.4.3: エラーハンドリング
- [ ] **タスク4.4.3.1**: 404ページ実装
- [ ] **タスク4.4.3.2**: エラーハンドリング共通処理

- [ ] **エピック4.4レビュー、リファクタリング**

- [ ] **フェーズ4レビュー、リファクタリング**

### フェーズ5: 機能連携・テスト
#### エピック5.1: 統合テスト
##### ストーリー5.1.1: 基本フロー確認
- [ ] **タスク5.1.1.1**: ユーザー登録・プロフィール設定フロー確認
- [ ] **タスク5.1.1.2**: ユーザー一覧とLike機能確認
- [ ] **タスク5.1.1.3**: マッチング成立とチャット機能確認
- [ ] **タスク5.1.1.4**: マッチキャンセル機能確認

##### ストーリー5.1.2: エラーケース検証
- [ ] **タスク5.1.2.1**: ネットワークエラー時の基本動作確認
- [ ] **タスク5.1.2.2**: 主要API失敗時のエラー表示確認
- [ ] **タスク5.1.2.3**: フォーム入力エラー時の動作確認

##### ストーリー5.1.3: レスポンシブ対応確認
- [ ] **タスク5.1.3.1**: モバイルサイズでの表示確認
- [ ] **タスク5.1.3.2**: デスクトップサイズでの表示確認

- [ ] **エピック5.1レビュー、リファクタリング**

#### エピック5.2: パフォーマンス最適化
##### ストーリー5.2.1: キャッシュと通信最適化
- [ ] **タスク5.2.1.1**: ユーザー一覧のキャッシュ時間調整
- [ ] **タスク5.2.1.2**: チャットメッセージのポーリング間隔の調整と検証（3秒間隔の適正評価）
- [ ] **タスク5.2.1.3**: マッチング確認ポーリングの負荷検証（7秒間隔の効果測定）

- [ ] **エピック5.2レビュー、リファクタリング**

#### エピック5.3: デプロイ準備
##### ストーリー5.3.1: 環境設定
- [ ] **タスク5.3.1.1**: 本番環境用変数定義
- [ ] **タスク5.3.1.2**: シークレット登録

##### ストーリー5.3.2: Supabaseプロジェクト設定
- [ ] **タスク5.3.2.1**: リモートプロジェクト作成
- [ ] **タスク5.3.2.2**: 本番環境セキュリティ設定

##### ストーリー5.3.3: データマイグレーション
- [ ] **タスク5.3.3.1**: マイグレーションスクリプト確認・調整
- [ ] **タスク5.3.3.2**: スキーマ移行実行
- [ ] **タスク5.3.3.3**: インデックスとRLSポリシー移行
- [ ] **タスク5.3.3.4**: 移行後のスキーマ検証

##### ストーリー5.3.4: 本番配置
- [ ] **タスク5.3.4.1**: Supabaseプロジェクト設定確認
- [ ] **タスク5.3.4.2**: フロントエンドのビルド確認
- [ ] **タスク5.3.4.3**: Vercelへのデプロイ実行
- [ ] **タスク5.3.4.4**: デプロイ後テスト

- [ ] **エピック5.3レビュー、リファクタリング**

#### エピック5.4: 最終調整
##### ストーリー5.4.1: 品質確認
- [ ] **タスク5.4.1.1**: ゴーストユーザー対策の動作確認（20分タイムアウトの挙動）
- [ ] **タスク5.4.1.2**: マッチキャンセル後の状態遷移と再マッチング検証
- [ ] **タスク5.4.1.3**: チャットのポーリング制御（バックグラウンド/フォアグラウンド切替時）
- [ ] **タスク5.4.1.4**: ネットワークエラー時のフォールバック動作確認

##### ストーリー5.4.2: ドキュメント更新
- [ ] **タスク5.4.2.1**: README更新
- [ ] **タスク5.4.2.2**: 要件定義書最終化

- [ ] **エピック5.4レビュー、リファクタリング**

- [ ] **フェーズ5レビュー、リファクタリング**

## 使用方法
1. タスク完了時にチェックボックスを埋める（`[ ]` → `[x]`）
2. 進捗状況に応じてタスクの追加・変更を行う
3. MVPの要件に沿って優先順位を調整する

## 開発フロー
1. Supabase CLIを使用してローカル環境で開発
2. ローカル環境での動作確認と調整
3. デプロイ直前に本番用Supabaseプロジェクトを作成
4. ローカルDBから本番環境へマイグレーション
5. Vercelへのフロントエンドデプロイ

## 注意事項
- MVPの目的は「最小限の機能で実用的な製品を迅速に完成させる」こと
- 要件定義（`/docs`）から逸脱する変更は事前承認と文書更新が必要
- 作業はAIコーディングエージェントとユーザーの協力で進める
- ローカル開発を基本とし、本番環境への移行は最終段階で行う
