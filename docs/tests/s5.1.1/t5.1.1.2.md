# ユーザー一覧とLike機能テスト

## 概要
このファイルではユーザー一覧表示とLike機能の統合テストケースを定義します。

## 前提条件
- テスト環境: ローカル開発環境（Supabase CLI起動済み）
- ブラウザ: Chrome
- 少なくとも2名のテストユーザーがすでに登録されていること

## テストケース

### TC-01: ユーザー一覧の表示
**目的**: 適切な条件を満たすユーザーのみが一覧に表示されることを確認する

**手順**:
1. テストユーザー1でランチ設定を行い、/usersページに遷移
2. 表示されているユーザー一覧を確認
3. 別ブラウザ/シークレットウィンドウでテストユーザー2を登録
4. テストユーザー2の画面で、テストユーザー1が一覧に表示されることを確認
5. テストユーザー1の画面をリロード
6. テストユーザー1の画面で、テストユーザー2が一覧に表示されることを確認

**期待結果**:
- 自分（テストユーザー1）は自分の画面の一覧に表示されない
- テストユーザー2の画面にはテストユーザー1が表示される（相互に表示が確認できる）
- 最近20分以内に募集開始したユーザーのみが表示される
- 各ユーザーカードには以下の情報が表示される：
  - ニックネーム
  - 学年と学部の表示（「3年 経済学部」形式）
  - 空き時間（~HH:MM形式）
  - 食べたい場所

**実行結果**:
- [-] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-02: 手動リロード機能
**目的**: 手動リロードボタンにより最新データを取得できることを確認する

**手順**:
1. テストユーザー1で/usersページを表示
2. 別ブラウザ/シークレットウィンドウでテストユーザー3を新規登録
3. テストユーザー1の画面で手動リロードボタンを押す

**期待結果**:
- リロードボタン押下後、テストユーザー3が一覧に表示される
- 最終更新時刻が更新される
- ローディング中は適切なインジケータが表示される

**実行結果**:
- [-] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-03: "とりまランチ？"（Like）機能
**目的**: Like機能の動作が適切であることを確認する

**手順**:
1. テストユーザー1で/usersページを表示
2. テストユーザー2の「とりまランチ？」ボタンをクリック
3. ボタンの状態変化を確認
4. テストユーザー1の画面で、テストユーザー2のカードを確認

**期待結果**:
- 「とりまランチ？」ボタンクリック後、ボタンの見た目が「いいね済み」状態に変わる
- DB内のlikesテーブルにレコードが追加される（from_user_id=テストユーザー1のID, to_user_id=テストユーザー2のID）
- この時点ではまだマッチは成立せず、通常のユーザー一覧表示のままである

**実行結果**:
- [-] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-04: 相互Likeによるマッチング
**目的**: 相互Likeでマッチングが正常に成立することを確認する

**手順**:
1. テストユーザー1が既にテストユーザー2に「とりまランチ？」を押している状態
2. 別ブラウザ/シークレットウィンドウのテストユーザー2で/usersページを表示
3. テストユーザー2からテストユーザー1への「とりまランチ？」ボタンをクリック

**期待結果**:
- テストユーザー2がテストユーザー1に「とりまランチ？」を押すと、両画面にマッチング成立ポップアップが表示される
- DB内のmatchesテーブルに新しいレコードが追加される
- 両ユーザーのis_matchedがtrueに更新される
- 数秒後、または「OK」ボタン押下後に両ユーザーとも自動的に/chatページに遷移する

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-05: マッチング後のユーザー一覧表示
**目的**: マッチング成立後、該当ユーザーが一覧から適切に除外されることを確認する

**手順**:
1. テストユーザー3（未マッチ）で/usersページを表示
2. テストユーザー1とテストユーザー2（既にマッチ成立済み）の表示を確認

**期待結果**:
- 既にマッチしているテストユーザー1とテストユーザー2はユーザー一覧に表示されない（is_matched=trueのため）
- テストユーザー3からは、マッチ済みのユーザーを「とりまランチ？」できない

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-06: 非アクティブユーザー（ゴーストユーザー）の表示
**目的**: 長時間非アクティブなユーザーが適切に一覧から除外されることを確認する

**手順**:
1. データベースでテストユーザー4のrecruiting_sinceを21分前の時刻に手動で設定
2. テストユーザー1で/usersページを表示
3. テストユーザー4の表示を確認

**期待結果**:
- 募集開始から20分以上経過したテストユーザー4は一覧に表示されない
- テストユーザー4はランチ設定画面(/setup)で再設定することで再び一覧に表示されるようになる

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-07: プロフィール・ステータス編集機能
**目的**: /usersページからプロフィール・ステータス編集画面への遷移が正常に機能することを確認する

**手順**:
1. テストユーザー1で/usersページを表示
2. プロフィール・ステータス編集ボタン（画面左上）をクリック
3. /setupページに遷移したことを確認
4. プロフィール情報が適切に表示されていることを確認
5. 情報を編集してOKボタンを押す
6. /usersページに戻り、変更が反映されていることを確認

**期待結果**:
- 編集ボタンクリックで/setupページに遷移する
- 現在のプロフィール・ステータス情報が適切に表示される
- 情報を変更後、OKボタンで/usersページに戻る
- 変更した情報がDBに保存され、他のユーザーからも更新後の情報が見えるようになる

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-08: エラーハンドリング
**目的**: ネットワークエラーやサーバーエラー時の動作を確認する

**手順**:
1. ネットワーク接続を意図的に切断（開発ツールのネットワークタブで「オフライン」を選択）
2. 手動リロードボタンを押す
3. 「とりまランチ？」ボタンをクリック
4. ネットワーク接続を復旧
5. 再度操作を試みる

**期待結果**:
- ネットワークエラー時に適切なエラーメッセージが表示される
- 接続復旧後の操作では正常に機能する
- データの不整合が発生しない

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-09: マッチング自動検出
**目的**: バックグラウンドでのマッチング成立検出が適切に機能することを確認する

**手順**:
1. テストユーザー1はテストユーザー5にLikeを送った状態で待機
2. 別ブラウザでテストユーザー5がテストユーザー1にLikeを送信

**期待結果**:
- テストユーザー1の画面に、ポーリングによるマッチング通知が表示される（約7秒以内）
- 通知ポップアップの後、自動的に/chatページに遷移する

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:

### TC-10: 募集状態の有効期限表示
**目的**: 募集状態の有効期限が適切に表示されることを確認する

**手順**:
1. テストユーザー1で/usersページを表示
2. 画面上部の説明テキストを確認

**期待結果**:
- 「募集状態は20分間有効です」というテキストが表示されている
- 「20分経過した場合、再度ランチ設定画面に戻り、再設定してください」という説明が表示されている

**実行結果**:
- [ ] 成功
- [ ] 失敗
  - 失敗内容:
  - スクリーンショット:
